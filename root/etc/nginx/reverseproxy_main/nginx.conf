worker_processes 1;

error_log /var/log/nginx/error.log;

events {
    worker_connections 1024;
}

http {
    client_max_body_size 100m;

    # On oblige le passage en HTTPS
    server {
        listen  80 default_server;
        server_name lyra-aurigae.space *.lyra-aurigae.space;

        # Passage en HTTPS
        return 301 https://$host$request_uri;
    }

    # On bloque l'accès à tous les (sous-)domaines non gérés (front-end)
    server {
        listen 443 ssl default_server;
        include /etc/nginx/conf.d/reverseproxy_main_include_ssl.conf;
        return 404;
    }

    # On bloque l'accès à tous les (sous-)domaines non gérés (admin)
    server {
        listen 8080 ssl default_server;
        include /etc/nginx/conf.d/reverseproxy_main_include_ssl.conf;
        return 404;
    }

    include /etc/nginx/sites-enabled/*;
}